<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>å—é–€åœ‹å°æ‹¼å­—æŒ‘æˆ° Go</title>

<style>
:root{
  --bg:#f0f9ff; --card:#fff; --ink:#0f172a; --muted:#64748b;
  --blue:#38bdf8; --green:#22c55e; --red:#fb7185; --amber:#facc15;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,"Noto Sans TC","PingFang TC",sans-serif;color:var(--ink)}
.hidden{display:none}
.center{text-align:center}
.top{position:sticky;top:0;background:#eaf6ff;padding:8px 12px;display:flex;gap:8px;align-items:center;justify-content:space-between}
.brand{font-weight:900}
.btn{border:0;border-radius:16px;padding:10px 14px;font-weight:900;cursor:pointer}
.primary{background:var(--blue);color:#fff}
.ghost{background:#fff;border:1px solid #e0f2fe}
.card{background:var(--card);margin:12px;border-radius:24px;padding:16px;box-shadow:0 12px 28px rgba(56,189,248,.2)}
.opt{display:block;width:100%;margin:8px 0;padding:14px;border-radius:16px;border:1px solid #e0f2fe;background:#fff;font-weight:900}
.bar{height:14px;background:#e5e7eb;border-radius:999px;overflow:hidden}
.bar>div{height:100%;background:var(--green)}
.map{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.node{height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;background:#e0f2fe}
.node.now{background:var(--blue);color:#fff}
.node.done{background:var(--green);color:#fff}
.bad{color:var(--red);font-weight:900}
.ok{color:var(--green);font-weight:900}

/* ç™¼éŸ³é€Ÿåº¦ */
.speed{font-size:14px;color:#334155;text-align:center;margin-top:6px}

/* å½©å¸¶ */
#confetti{position:fixed;inset:0;pointer-events:none;z-index:9999}
.confetti{position:absolute;width:10px;height:14px;animation:fall 1.8s linear forwards}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg)}}

/* è€å¸«è¡¨ */
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #e5e7eb;padding:8px;text-align:left;font-weight:700}
th{background:#f1f5f9}
</style>
</head>

<body>

<div class="top">
  <div class="brand">ğŸ¦Š å—é–€åœ‹å°æ‹¼å­—æŒ‘æˆ° Go</div>
  <div>
    <button class="btn ghost" onclick="toggleTeacher()">è€å¸«å¾Œå°</button>
  </div>
</div>

<!-- å­¸ç”Ÿç™»å…¥ -->
<div id="login" class="card center">
  <h2>å­¸ç”Ÿç™»å…¥</h2>
  <input id="name" placeholder="è¼¸å…¥å­¸ç”Ÿå§“å" />
  <div style="height:8px"></div>
  <button class="btn primary" onclick="login()">é–‹å§‹</button>
</div>

<!-- åœ°åœ– -->
<div id="mapView" class="card hidden">
  <h2 class="center">ğŸ—ºï¸ é—œå¡åœ°åœ–</h2>
  <div id="map" class="map"></div>
</div>

<!-- éŠæˆ² -->
<div id="gameView" class="card hidden">
  <div class="bar"><div id="barFill"></div></div>
  <h3 id="qText" class="center"></h3>
  <div id="opts"></div>
  <div id="hint" class="center"></div>
  <div class="speed">
    ğŸšï¸ ç™¼éŸ³é€Ÿåº¦
    <input type="range" min="0.5" max="1.1" step="0.05" id="rate">
    <span id="rateLabel"></span>
  </div>
  <div class="center">
    <button id="nextBtn" class="btn primary hidden" onclick="nextQ()">ä¸‹ä¸€é¡Œ</button>
  </div>
</div>

<!-- è€å¸«å¾Œå° -->
<div id="teacher" class="card hidden">
  <h2>ğŸ‘©â€ğŸ« è€å¸«å¾Œå°</h2>
  <button class="btn primary" onclick="exportCSV()">åŒ¯å‡º CSV</button>
  <div style="height:8px"></div>
  <table>
    <thead><tr><th>å­¸ç”Ÿ</th><th>é€šé—œæ•¸</th></tr></thead>
    <tbody id="tBody"></tbody>
  </table>
</div>

<script>
/* ===== 153 é¡Œåº« ===== */
const WORDS=[
{en:"apple",zh:"è˜‹æœ"},{en:"banana",zh:"é¦™è•‰"},{en:"bread",zh:"éºµåŒ…"},{en:"cake",zh:"è›‹ç³•"},{en:"egg",zh:"è›‹"},
{en:"rice",zh:"é£¯"},{en:"milk",zh:"ç‰›å¥¶"},{en:"juice",zh:"æœæ±"},{en:"water",zh:"æ°´"},{en:"fish",zh:"é­š"},
{en:"father",zh:"çˆ¸çˆ¸"},{en:"mother",zh:"åª½åª½"},{en:"brother",zh:"å“¥å“¥"},{en:"sister",zh:"å§å§"},{en:"family",zh:"å®¶åº­"},
{en:"grandpa",zh:"çˆºçˆº"},{en:"grandma",zh:"å¥¶å¥¶"},
{en:"cat",zh:"è²“"},{en:"dog",zh:"ç‹—"},{en:"bird",zh:"é³¥"},{en:"duck",zh:"é´¨å­"},{en:"pig",zh:"è±¬"},
{en:"cow",zh:"ç‰›"},{en:"horse",zh:"é¦¬"},{en:"tiger",zh:"è€è™"},{en:"lion",zh:"ç…å­"},
{en:"red",zh:"ç´…è‰²"},{en:"blue",zh:"è—è‰²"},{en:"yellow",zh:"é»ƒè‰²"},{en:"green",zh:"ç¶ è‰²"},
{en:"black",zh:"é»‘è‰²"},{en:"white",zh:"ç™½è‰²"},{en:"brown",zh:"æ£•è‰²"},{en:"pink",zh:"ç²‰ç´…è‰²"},
{en:"book",zh:"æ›¸"},{en:"pen",zh:"ç­†"},{en:"pencil",zh:"é‰›ç­†"},{en:"eraser",zh:"æ©¡çš®æ“¦"},
{en:"bag",zh:"æ›¸åŒ…"},{en:"desk",zh:"æ¡Œå­"},{en:"chair",zh:"æ¤…å­"},
{en:"school",zh:"å­¸æ ¡"},{en:"teacher",zh:"è€å¸«"},{en:"student",zh:"å­¸ç”Ÿ"},
{en:"head",zh:"é ­"},{en:"eye",zh:"çœ¼ç›"},{en:"ear",zh:"è€³æœµ"},{en:"nose",zh:"é¼»å­"},
{en:"mouth",zh:"å˜´å·´"},{en:"hand",zh:"æ‰‹"},{en:"leg",zh:"è…¿"},{en:"foot",zh:"è…³"},
{en:"go",zh:"å»"},{en:"come",zh:"ä¾†"},{en:"run",zh:"è·‘"},{en:"walk",zh:"èµ°"},{en:"jump",zh:"è·³"},
{en:"eat",zh:"åƒ"},{en:"drink",zh:"å–"},{en:"see",zh:"çœ‹è¦‹"},{en:"hear",zh:"è½"},
{en:"say",zh:"èªª"},{en:"read",zh:"è®€"},{en:"write",zh:"å¯«"},{en:"play",zh:"ç©"},
{en:"sleep",zh:"ç¡è¦º"},{en:"help",zh:"å¹«å¿™"},
{en:"sun",zh:"å¤ªé™½"},{en:"moon",zh:"æœˆäº®"},{en:"star",zh:"æ˜Ÿæ˜Ÿ"},{en:"sky",zh:"å¤©ç©º"},
{en:"rain",zh:"é›¨"},{en:"wind",zh:"é¢¨"},{en:"tree",zh:"æ¨¹"},{en:"flower",zh:"èŠ±"},
{en:"one",zh:"ä¸€"},{en:"two",zh:"äºŒ"},{en:"three",zh:"ä¸‰"},{en:"four",zh:"å››"},{en:"five",zh:"äº”"},
{en:"six",zh:"å…­"},{en:"seven",zh:"ä¸ƒ"},{en:"eight",zh:"å…«"},{en:"nine",zh:"ä¹"},{en:"ten",zh:"å"},
{en:"big",zh:"å¤§çš„"},{en:"small",zh:"å°çš„"},{en:"good",zh:"å¥½çš„"},{en:"bad",zh:"ä¸å¥½çš„"},
{en:"happy",zh:"é–‹å¿ƒçš„"},{en:"sad",zh:"é›£éçš„"},{en:"hot",zh:"ç†±çš„"},{en:"cold",zh:"å†·çš„"},
{en:"new",zh:"æ–°çš„"},{en:"old",zh:"èˆŠçš„"},{en:"fast",zh:"å¿«çš„"},{en:"slow",zh:"æ…¢çš„"},
{en:"car",zh:"è»Šå­"},{en:"bus",zh:"å…¬è»Š"},{en:"bike",zh:"è…³è¸è»Š"},
{en:"house",zh:"æˆ¿å­"},{en:"home",zh:"å®¶"},{en:"door",zh:"é–€"},
{en:"window",zh:"çª—æˆ¶"},{en:"clock",zh:"æ™‚é˜"},{en:"toy",zh:"ç©å…·"},{en:"ball",zh:"çƒ"}
];

/* ===== ç‹€æ…‹ ===== */
const Q_PER=10, LEVELS=100;
let student="", level=1, q=0, score=0, cur=null;
let passed=JSON.parse(localStorage.getItem("passed")||"{}");
let stats=JSON.parse(localStorage.getItem("stats")||"{}");

/* ===== ç™¼éŸ³ ===== */
let RATE=Number(localStorage.getItem("rate")||0.65);
rate.value=RATE; rateLabel.textContent=RATE;
rate.oninput=e=>{RATE=Number(e.target.value);rateLabel.textContent=RATE;localStorage.setItem("rate",RATE)};
function speak(w){
  const vs=speechSynthesis.getVoices();
  const v=vs.find(x=>x.lang==="en-US"&&x.name.includes("Samantha"))||vs.find(x=>x.lang==="en-US")||vs[0];
  speechSynthesis.cancel();
  const u1=new SpeechSynthesisUtterance(w); u1.voice=v; u1.lang="en-US"; u1.rate=RATE;
  const u2=new SpeechSynthesisUtterance(w); u2.voice=v; u2.lang="en-US"; u2.rate=Math.min(RATE+.2,1.2);
  speechSynthesis.speak(u1); speechSynthesis.speak(u2);
}

/* ===== ç™»å…¥/åœ°åœ– ===== */
function login(){
  student=name.value.trim(); if(!student) return alert("è«‹è¼¸å…¥å§“å");
  loginDiv(); drawMap();
}
function loginDiv(){login.classList.add("hidden"); mapView.classList.remove("hidden");}
function drawMap(){
  map.innerHTML="";
  for(let i=1;i<=LEVELS;i++){
    const d=document.createElement("div");
    d.className="node "+(passed[i]?"done":i===level?"now":"");
    d.textContent=i;
    d.onclick=()=>startLevel(i);
    map.appendChild(d);
  }
}
function startLevel(l){
  level=l; q=0; score=0;
  mapView.classList.add("hidden"); gameView.classList.remove("hidden");
  nextQ();
}

/* ===== å‡ºé¡Œï¼ˆA/B/C/D éš¨æ©Ÿï¼›ä¸€é—œ 10 é¡Œï¼‰ ===== */
function nextQ(){
  nextBtn.classList.add("hidden"); hint.textContent="";
  if(q>=Q_PER){ finish(); return; }
  cur=WORDS[Math.floor(Math.random()*WORDS.length)];
  const mode=["A","B","C","D"][Math.floor(Math.random()*4)];
  opts.innerHTML="";
  if(mode==="A"){ // è½â†’é¸ä¸­ï¼ˆä¸é¡¯è‹±ï¼‰
    qText.textContent="ğŸ”Š è½éŸ³ï¼Œé¸æ­£ç¢ºä¸­æ–‡";
    speak(cur.en);
    makeChoices(cur.zh,false);
  }else if(mode==="B"){ // çœ‹è‹±â†’é¸ä¸­
    qText.textContent=cur.en;
    makeChoices(cur.zh,true);
  }else if(mode==="C"){ // é…å°ï¼ˆç°¡åŒ–ï¼šé¸å°ï¼‰
    qText.textContent="è‹±ä¸­é…å°ï¼š"+cur.en;
    makeChoices(cur.zh,true);
  }else{ // D è½â†’æ‹¼
    qText.textContent="ğŸ”Š è½éŸ³ï¼Œæ‹¼è‹±æ–‡";
    speak(cur.en);
    const letters=shuffle(cur.en.split(""));
    letters.forEach(ch=>{
      const b=document.createElement("button"); b.className="opt"; b.textContent=ch;
      b.onclick=()=>{ b.classList.add("hidden"); guess+=ch; if(guess.length===cur.en.length) checkSpell(); };
      opts.appendChild(b);
    });
    guess=""; return;
  }
  q++; barFill.style.width=(q/Q_PER*100)+"%";
}
let guess="";
function makeChoices(ans,showEn){
  const pool=shuffle(WORDS.map(x=>x.zh)).slice(0,3);
  const choices=shuffle([ans,...pool]);
  choices.forEach(c=>{
    const b=document.createElement("button"); b.className="opt"; b.textContent=c;
    b.onclick=()=>{
      if(c===ans){score++; hint.innerHTML='<span class="ok">âœ… ç­”å°</span>';}
      else{hint.innerHTML='<span class="bad">âŒ æ­£ç¢ºç­”æ¡ˆï¼š'+ans+'</span>';}
      nextBtn.classList.remove("hidden");
    };
    opts.appendChild(b);
  });
}
function checkSpell(){
  if(guess===cur.en){score++; hint.innerHTML='<span class="ok">âœ… ç­”å°</span>';}
  else{hint.innerHTML='<span class="bad">âŒ æ­£ç¢ºæ‹¼å­—ï¼š'+cur.en+'</span>';}
  nextBtn.classList.remove("hidden");
}

/* ===== çµæŸ/å½©å¸¶ ===== */
function finish(){
  gameView.innerHTML='<h2 class="center">ğŸ‰ å®Œæˆ '+score+'/'+Q_PER+'</h2><div class="center"><button class="btn primary" onclick="back()">å›åœ°åœ–</button></div>';
  if(!passed[level]) confetti();
  passed[level]=true; localStorage.setItem("passed",JSON.stringify(passed));
  stats[student]=stats[student]||{passed:0};
  stats[student].passed=Object.keys(passed).length;
  localStorage.setItem("stats",JSON.stringify(stats));
}
function back(){location.reload();}
function confetti(){
  const wrap=document.createElement("div"); wrap.id="confetti"; document.body.appendChild(wrap);
  const colors=["#22c55e","#38bdf8","#facc15","#fb7185"];
  for(let i=0;i<80;i++){
    const c=document.createElement("div"); c.className="confetti";
    c.style.left=Math.random()*100+"vw"; c.style.background=colors[Math.floor(Math.random()*colors.length)];
    wrap.appendChild(c);
  }
  setTimeout(()=>wrap.remove(),2000);
}
function shuffle(a){return a.sort(()=>.5-Math.random())}

/* ===== è€å¸«å¾Œå° ===== */
function toggleTeacher(){
  teacher.classList.toggle("hidden");
  renderTeacher();
}
function renderTeacher(){
  const tb=document.getElementById("tBody"); tb.innerHTML="";
  Object.keys(stats).forEach(s=>{
    const tr=document.createElement("tr");
    tr.innerHTML='<td>'+s+'</td><td>'+stats[s].passed+'</td>';
    tb.appendChild(tr);
  });
}
function exportCSV(){
  let csv="å­¸ç”Ÿ,é€šé—œæ•¸\n";
  Object.keys(stats).forEach(s=>csv+=`${s},${stats[s].passed}\n`);
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="progress.csv"; a.click();
}
</script>
</body>
</html>
