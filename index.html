<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ« å—é–€åœ‹å°æ‹¼å­—æŒ‘æˆ° GO</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f5f7fb;margin:0;padding:16px}
.card{max-width:560px;margin:auto;background:#fff;border-radius:16px;padding:18px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
h1{text-align:center;font-size:20px;margin:0 0 10px}
.btn{padding:10px 14px;border:none;border-radius:10px;font-size:14px;cursor:pointer;margin:4px}
.primary{background:#4f7cff;color:#fff}
.secondary{background:#e9ecf3}
.choice{background:#f0f3ff;width:100%}
.row{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
.word{font-size:30px;font-weight:bold;text-align:center;margin:12px}
.sub{text-align:center;color:#666}
.msg{text-align:center;margin-top:6px}
.ok{color:#2ecc71;font-weight:bold}
.bad{color:#ff4d4f;font-weight:bold}
select,input{padding:8px;border-radius:8px;border:1px solid #ccc}
</style>
</head>

<body>
<div class="card">
<h1>ğŸ« å—é–€åœ‹å°æ‹¼å­—æŒ‘æˆ° GO</h1>

<div id="studentArea"></div>
<hr>

<div id="game"></div>

<button class="btn secondary" onclick="teacher()">ğŸ‘©â€ğŸ« è€å¸«å¾Œå°</button>
</div>

<script>
/* ===== åŸºæœ¬è³‡æ–™ ===== */
const WORDS=[
{en:"apple",zh:"è˜‹æœ"},{en:"book",zh:"æ›¸"},{en:"cat",zh:"è²“"},
{en:"dog",zh:"ç‹—"},{en:"ball",zh:"çƒ"},{en:"bird",zh:"é³¥"},
{en:"milk",zh:"ç‰›å¥¶"},{en:"fish",zh:"é­š"}
];
const TYPES=["listen","spell","match"];

/* ===== å­˜å– ===== */
let DB=JSON.parse(localStorage.getItem("NM_DB"))||{students:{},current:""};
function save(){localStorage.setItem("NM_DB",JSON.stringify(DB));}

/* ===== å­¸ç”Ÿ ===== */
function renderStudents(){
  let s=Object.keys(DB.students).map(n=>`<option>${n}</option>`).join("");
  studentArea.innerHTML=`
    å­¸ç”Ÿï¼š
    <select onchange="selectStudent(this.value)">${s}</select>
    <input id="newName" placeholder="æ–°å¢å­¸ç”Ÿ">
    <button class="btn primary" onclick="addStudent()">æ–°å¢</button>`;
}
function addStudent(){
  let n=newName.value.trim();
  if(!n||DB.students[n])return;
  DB.students[n]={level:1,q:1,records:[]};
  DB.current=n; save(); renderStudents(); renderGame();
}
function selectStudent(n){DB.current=n; save(); renderGame();}

/* ===== éŠæˆ² ===== */
function renderGame(){
  if(!DB.current){game.innerHTML="<p>è«‹å…ˆæ–°å¢å­¸ç”Ÿ</p>";return;}
  let st=DB.students[DB.current];
  let w=WORDS[Math.floor(Math.random()*WORDS.length)];
  let t=TYPES[Math.floor(Math.random()*TYPES.length)];

  if(t==="listen"){
    game.innerHTML=`
      <div class="sub">ğŸ‘‚ è½ä¸€è½</div>
      <div class="word">${w.en}</div>
      <button class="btn secondary" onclick="speak('${w.en}')">ğŸ”Š è½</button>
      <button class="btn primary" onclick="next(true,'listen','${w.en}')">å®Œæˆ</button>`;
  }
  if(t==="spell"){
    game.innerHTML=`
      <div class="sub">ğŸ”¤ æ‹¼ä¸€æ‹¼</div>
      <div class="word">${w.zh}</div>
      <button class="btn primary" onclick="next(true,'spell','${w.en}')">å®Œæˆ</button>`;
  }
  if(t==="match"){
    let opts=[w.zh,...WORDS.slice(0,2).map(x=>x.zh)].sort(()=>Math.random()-.5);
    game.innerHTML=`
      <div class="sub">ğŸ§© é…å°</div>
      <div class="word">${w.en}</div>
      ${opts.map(o=>`<button class="btn choice" onclick="check('${o}','${w.zh}','${w.en}')">${o}</button>`).join("")}`;
  }
}
function speak(t){speechSynthesis.speak(new SpeechSynthesisUtterance(t));}
function check(o,a,en){
  next(o===a,"match",en);
}
function next(ok,type,en){
  DB.students[DB.current].records.push({
    student:DB.current,word:en,type,ok,time:new Date().toISOString()
  });
  save(); renderGame();
}

/* ===== è€å¸«å¾Œå° ===== */
function teacher(){
  let rows=[];
  Object.values(DB.students).forEach(s=>{
    s.records.forEach(r=>rows.push(r));
  });
  game.innerHTML=`
    <h3>ğŸ‘©â€ğŸ« è€å¸«å¾Œå°</h3>
    <button class="btn primary" onclick="exportCSV()">ğŸ“¤ åŒ¯å‡º Excel</button>
    <p>å…±æœ‰ ${rows.length} ç­†ä½œç­”ç´€éŒ„</p>`;
}

/* ===== åŒ¯å‡º ===== */
function exportCSV(){
  let rows=["å­¸ç”Ÿ,å–®å­—,é¡Œå‹,æ˜¯å¦æ­£ç¢º"];
  Object.values(DB.students).forEach(s=>{
    s.records.forEach(r=>{
      rows.push(`${r.student},${r.word},${r.type},${r.ok?"æ­£ç¢º":"éŒ¯èª¤"}`);
    });
  });
  let blob=new Blob([rows.join("\n")],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="æ‹¼å­—æˆç¸¾.csv";
  a.click();
}

/* ===== å•Ÿå‹• ===== */
renderStudents(); renderGame();
</script>
</body>
</html>
