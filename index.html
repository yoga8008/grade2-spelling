<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>å—é–€åœ‹å°æ‹¼å­—æŒ‘æˆ° Go</title>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", system-ui;
  background: linear-gradient(180deg,#f0f6ff,#ffffff);
}
#app {
  max-width: 900px;
  margin: auto;
  padding: 16px;
}
.hidden { display:none; }

button {
  padding: 12px 16px;
  border-radius: 14px;
  border: none;
  font-size: 16px;
  background: #4f7cff;
  color: white;
}

.card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
}

.map {
  display: grid;
  grid-template-columns: repeat(5,1fr);
  gap: 14px;
}

.level {
  background:#e8f0ff;
  border-radius:16px;
  padding:14px;
  text-align:center;
  cursor:pointer;
}

.correct { color:green; font-weight:bold; }
.wrong { color:red; font-weight:bold; }

.option {
  background:#f1f3f8;
  padding:14px;
  border-radius:14px;
  margin:10px 0;
  cursor:pointer;
}

#confetti {
  position:fixed;
  inset:0;
  pointer-events:none;
}
</style>
</head>

<body>
<div id="app">

<!-- ç™»å…¥ -->
<div id="login" class="card">
  <h2>å—é–€åœ‹å°æ‹¼å­—æŒ‘æˆ° Go</h2>
  <input id="studentName" placeholder="è¼¸å…¥å­¸ç”Ÿå§“å" style="padding:12px;width:100%;font-size:16px;">
  <br><br>
  <button onclick="login()">é–‹å§‹</button>
</div>

<!-- åœ°åœ– -->
<div id="map" class="hidden">
  <h3>ğŸ—ºï¸ é—œå¡åœ°åœ–</h3>
  <div class="map" id="mapGrid"></div>
  <br>
  <button onclick="openTeacher()">ğŸ‘©â€ğŸ« è€å¸«å¾Œå°</button>
</div>

<!-- é—–é—œ -->
<div id="game" class="hidden card">
  <div id="status"></div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <div id="result"></div>
  <button onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
</div>

<!-- è€å¸« -->
<div id="teacher" class="hidden card">
  <h2>è€å¸«å¾Œå°</h2>
  <pre id="report"></pre>
  <button onclick="exportCSV()">åŒ¯å‡º Excel</button>
  <button onclick="back()">è¿”å›</button>
</div>

<canvas id="confetti"></canvas>

</div>

<script>
// ========= é¡Œåº«ï¼ˆè‡ªå‹•ç”¢ç”Ÿ 1000 é¡Œï¼‰ =========
const baseWords = [
 ["apple","è˜‹æœ"],["rain","é›¨"],["book","æ›¸"],["sun","å¤ªé™½"],
 ["dog","ç‹—"],["cat","è²“"],["milk","ç‰›å¥¶"],["egg","è›‹"],
 ["car","è»Š"],["bus","å…¬è»Š"],["red","ç´…è‰²"],["blue","è—è‰²"]
];

let wordBank = [];
for(let i=0;i<1000;i++){
  let w = baseWords[i % baseWords.length];
  wordBank.push({en:w[0]+i, zh:w[1]});
}

// ========= ç‹€æ…‹ =========
let user = "";
let level = 0;
let qIndex = 0;
let score = 0;
let record = JSON.parse(localStorage.getItem("records")||"{}");

// ========= ç™»å…¥ =========
function login(){
  user = document.getElementById("studentName").value.trim();
  if(!user) return alert("è«‹è¼¸å…¥å§“å");
  if(!record[user]) record[user]={};
  localStorage.setItem("records",JSON.stringify(record));
  document.getElementById("login").classList.add("hidden");
  showMap();
}

// ========= åœ°åœ– =========
function showMap(){
  document.getElementById("map").classList.remove("hidden");
  let grid = document.getElementById("mapGrid");
  grid.innerHTML="";
  for(let i=0;i<100;i++){
    let d=document.createElement("div");
    d.className="level";
    d.innerText="ç¬¬ "+(i+1)+" é—œ";
    d.onclick=()=>startLevel(i);
    grid.appendChild(d);
  }
}

// ========= é—œå¡ =========
function startLevel(lv){
  level=lv;
  qIndex=0;
  score=0;
  document.getElementById("map").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  nextQuestion();
}

function nextQuestion(){
  document.getElementById("result").innerHTML="";
  if(qIndex>=10){
    finishLevel();
    return;
  }
  let w = wordBank[level*10+qIndex];
  document.getElementById("status").innerText=
    `ç¬¬ ${qIndex+1}/10 é¡Œ`;
  document.getElementById("question").innerText="ğŸ”Š è½éŸ³é¸ä¸­æ–‡";
  speak(w.en);

  let opts=[w.zh];
  while(opts.length<4){
    opts.push(wordBank[Math.floor(Math.random()*wordBank.length)].zh);
  }
  opts.sort(()=>Math.random()-0.5);

  let box=document.getElementById("options");
  box.innerHTML="";
  opts.forEach(o=>{
    let div=document.createElement("div");
    div.className="option";
    div.innerText=o;
    div.onclick=()=>check(o===w.zh);
    box.appendChild(div);
  });
}

function check(ok){
  if(ok){
    score++;
    document.getElementById("result").innerHTML="<span class='correct'>âœ” æ­£ç¢º</span>";
  }else{
    document.getElementById("result").innerHTML="<span class='wrong'>âœ– éŒ¯èª¤</span>";
  }
  qIndex++;
}

function finishLevel(){
  record[user][level]={score};
  localStorage.setItem("records",JSON.stringify(record));
  confetti();
  alert(`å®Œæˆç¬¬ ${level+1} é—œï¼š${score}/10`);
  document.getElementById("game").classList.add("hidden");
  showMap();
}

// ========= ç™¼éŸ³ =========
function speak(t){
  let u=new SpeechSynthesisUtterance(t);
  u.lang="en-US";
  speechSynthesis.speak(u);
}

// ========= è€å¸« =========
function openTeacher(){
  document.getElementById("map").classList.add("hidden");
  document.getElementById("teacher").classList.remove("hidden");
  document.getElementById("report").innerText=JSON.stringify(record,null,2);
}

function exportCSV(){
  let csv="å­¸ç”Ÿ,é—œå¡,åˆ†æ•¸\n";
  for(let s in record){
    for(let l in record[s]){
      csv+=`${s},${+l+1},${record[s][l].score}\n`;
    }
  }
  let a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
  a.download="report.csv";
  a.click();
}

function back(){
  document.getElementById("teacher").classList.add("hidden");
  showMap();
}

// ========= å½©å¸¶ =========
function confetti(){
  let c=document.getElementById("confetti");
  let ctx=c.getContext("2d");
  c.width=innerWidth; c.height=innerHeight;
  for(let i=0;i<200;i++){
    ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`;
    ctx.fillRect(Math.random()*c.width,Math.random()*c.height,6,6);
  }
  setTimeout(()=>ctx.clearRect(0,0,c.width,c.height),1500);
}
</script>
</body>
</html>
